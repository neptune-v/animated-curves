<!DOCTYPE html>
<html lang="en" ontouchmove>
<head>
    <meta charset="UTF-8">
    <title>Visualizing Elliptic Curves</title>
    <script type="module" src="page.js"></script>
    <link href="site.css" rel="stylesheet">
    <!-- xxx todo grab only what we need -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
          rel="stylesheet" crossorigin="anonymous">
</head>
<body class="main-page">
<div class="container">
<h2>Consider the curve</h2>
<div>
<p>
    Every TLS 1.3 session starts with a key exchange
    made via an elliptic curve. The most popular curve is
    Curve25519, and the exchange involves adding a "base point"
    <math><mi>P</mi></math> to itself over and over again:
</p>
<figure class="illustration">
<div class="ill-content">
<div>
    <canvas id="canvas-curve25519" class="animated" width="500" height="300"></canvas>
</div>
</div>
    <figcaption>Curve25519 point addition</figcaption>
</figure>
<p>
    We're looking at the heart of TLS 1.3 key exchange,
    but what's going on? Let's break it down into simple parts.
</p>
</div>

<h2>Concept 1: Adding points on a curve</h2>
<p>
    The elliptic curves we're going to use are in this form:
    <math>
        <mrow>
            <msup><mi>y</mi><mn>2</mn></msup>
            <mo>=</mo>
            <msup><mi>x</mi><mn>3</mn></msup>
            <mo>+</mo><mi>A</mi><mi>x</mi>
            <mo>+</mo><mi>B</mi>
        </mrow>
    </math>
<br>

<div>
<figure class="illustration">
<div class="ill-content">
<div>
<canvas id="canvas-ec-sample" class="animated" width="500" height="300"></canvas>
</div>
</div>
    <figcaption>Examples of elliptic curves</figcaption>
</figure>

<p>
    Let's define <strong>point addition</strong>: a way to combine two points on an elliptic
    curve to yield a third point (also on the curve).
<div class="skinny-block">
    <strong>Point addition:</strong>
    <ul>
    <li>draw a line between the two points
    (or if you're adding a point to itself, make a line tangent to the curve at that
    point),</li>
    <li>find where that line intersects the curve,</li>
    <li>and finally negate the y-value of that point (flip it from positive to negative or vice versa).</li>
    </ul>
</div>
<p>We're going to use a shorthand for adding a point to itself multiple times (also called
    <strong>scalar multiplication</strong>):

    <math display="block" class="pthalf">
        <mrow>
            <mi>P</mi>
            <mspace width="-0.1667em"></mspace>
            <mo>+</mo>
            <mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>2</mn>
            <mi>P</mi>
        </mrow>
    </math>
    <math display="block">
        <mrow>
            <mi>P</mi>
            <mspace width="-0.1667em"></mspace>
            <mo>+</mo>
            <mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="-0.1667em"></mspace>
            <mo>+</mo>
            <mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>3</mn>
            <mi>P</mi>
        </mrow>
    </math>
    <math display="block">
        <mrow>
            <mi>P</mi>
            <mspace width="-0.1667em"></mspace>
            <mo>+</mo>
            <mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="-0.1667em"></mspace>
            <mo>+</mo>
            <mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="-0.1667em"></mspace>
            <mo>+</mo>
            <mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>4</mn>
            <mi>P</mi>
        </mrow>
    </math>
    <math display="block">
        <mrow>
            <mtext>... and so on</mtext>
        </mrow>
    </math>
<figure class="illustration">
<div class="ill-content">
<canvas id="canvas-real-add" class="animated" height="400" width="500"></canvas>
</div>
    <figcaption>Repeated addition of a point P</figcaption>
</figure>

<p>
    Point addition has two useful properties which we'll need later:
<ul class="skinny-block">
    <li><strong>commutative</strong>: adding points in any order results in the same point:
        <math display="block" class="pthalf pbhalf">
            <mrow>
                <mi>P</mi><mo>+</mo><mi>Q</mi><mo>+</mo>
                <mi>R</mi>
                <mspace width="0.2778em"></mspace>
                <mo>=</mo>
                <mspace width="0.2778em"></mspace>
                <mi>R</mi><mo>+</mo><mi>Q</mi><mo>+</mo>
                <mi>P</mi>
                <mspace width="0.2778em"></mspace>
                <mo>=</mo>
                <mspace width="0.2778em"></mspace>
                <mi>Q</mi><mo>+</mo><mi>R</mi><mo>+</mo>
                <mi>P</mi>
            </mrow>
        </math>
    <li><strong>associative</strong>: adding the results of additions results in the same point:
    <math display="block" class="pthalf">
        <mrow>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mo form="prefix" stretchy="false">(</mo>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mo form="postfix" stretchy="false">)</mo>
            <mo>+</mo>
            <mo form="prefix" stretchy="false">(</mo>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mo form="postfix" stretchy="false">)</mo>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>3</mn><mi>P</mi><mo>+</mo><mn>2</mn><mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>5</mn><mi>P</mi>
        </mrow>
    </math>
    <math display="block">
        <mrow>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi><mspace width="-0.1667em"></mspace><mo>+</mo><mspace width="-0.1667em"></mspace>
            <mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mo form="prefix" stretchy="false">(</mo><mi>P</mi><mo form="postfix" stretchy="false">)</mo>
            <mo>+</mo>
            <mo form="prefix" stretchy="false">(</mo><mi>P</mi><mspace width="-0.1667em"></mspace>
            <mo>+</mo><mspace width="-0.1667em"></mspace><mi>P</mi><mspace width="-0.1667em"></mspace>
            <mo>+</mo><mspace width="-0.1667em"></mspace><mi>P</mi><mspace width="-0.1667em"></mspace>
            <mo>+</mo><mspace width="-0.1667em"></mspace><mi>P</mi>
            <mo form="postfix" stretchy="false">)</mo>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>1</mn><mi>P</mi><mo>+</mo><mn>4</mn><mi>P</mi>
            <mspace width="0.2778em"></mspace>
            <mo>=</mo>
            <mspace width="0.2778em"></mspace>
            <mn>5</mn><mi>P</mi>
        </mrow>
    </math>
    </li>
</ul>
<p>See the animation below which adds points in random order.
    The result is always the expected point.</p>

<figure class="illustration">
<div class="ill-content">
<canvas id="canvas-real-assoc" class="animated" width="500" height="400"></canvas>
</div>
    <figcaption>Point addition is associative and commutative</figcaption>
</figure>
</div>

<h2>Concept 2: Finite field math</h2>
<div>
<p>Next let's put the curves aside and introduce a new set of math operations,
    the operations of the finite field <span class="fat-fp">Fp</span>.

<p>A finite field is just a set of numbers. In this section we'll set
    <math><mi>p</mi></math> to 23
    (a prime number). The finite field <span class="fat-fp-23">F23</span> is the list
    of numbers 0 through 22:
    <math display="block" class="pthalf">
        <mrow>
            <msub><mi>ùîΩ</mi><mn>23</mn></msub>
            <mo>=</mo>
            <mo form="prefix" stretchy="false">{</mo>
            <mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo>
            <mn>2</mn><mo separator="true">,</mo><mo>‚Ä¶</mo><mo separator="true">,</mo><mn>22</mn>
            <mo form="postfix" stretchy="false">}</mo>
        </mrow>
    </math>

<p>
All the math operations below use only those 23 numbers as inputs as outputs. No negative numbers,
    no floating point, and nothing higher than 22.

<h4>Addition and subtraction</h4>
<p>
Adding and subtracting in finite fields is pretty simple. Values of 23 and over will "wrap around" to zero, and values below
zero will wrap around to 22:
<canvas class="numline animated" id="canvas-field-add-sub" width="500" height="80"></canvas>

<p>You might also know this as "modulo 23", or as the remainder after dividing a number by 23.

<h4>Multiplication</h4>
<p>
Multiplication is also straightforward. Similar to addition, the result is taken modulo 23:

<canvas class="numline animated" id="canvas-field-mult" width="500" height="80"></canvas>

<h4>Negation</h4>
<p>
    You might be familiar with negation meaning flipping a value's sign from positive to negative
    (or vice versa). Another definition could be finding the value
    <math><mtext>-</mtext><mi>n</mi></math> for <math><mi>n</mi></math>
    that satisfies this equation:
    <math display="block">
        <mrow>
            <mi>n</mi>
            <mo>+</mo>
            <mtext>-</mtext>
            <mi>n</mi>
            <mo>=</mo>
            <mn>0</mn>
        </mrow>
    </math>

<p>
Using our rules for addition above, we can work out that to negate a number
    in <span class="fat-fp">Fp</span> we can just subtract that number from <math><mi>p</mi></math>:
    <math display=block>
        <mrow><mn>1</mn><mo>+</mo><mn>22</mn><mo>=</mo><mn>0</mn><mo separator="true">;</mo>
            <mspace width="0.2778em"></mspace>
            <mtext>1 negated is 22</mtext></mrow>
    </math>
    <math display=block>
        <mrow><mn>2</mn><mo>+</mo><mn>21</mn><mo>=</mo><mn>0</mn><mo separator="true">;</mo>
            <mspace width="0.2778em"></mspace>
            <mtext>2 negated is 21</mtext></mrow>
    </math>
    <math display=block>
        <mrow><mn>3</mn><mo>+</mo><mn>20</mn><mo>=</mo><mn>0</mn><mo separator="true">;</mo>
            <mspace width="0.2778em"></mspace>
            <mtext>3 negated is 20</mtext></mrow>
    </math>
    <math display=block>
        <mrow><mo>‚Ä¶</mo></mrow>
    </math>
    <math display=block>
        <mrow><mn>22</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>0</mn><mo separator="true">;</mo>
            <mspace width="0.2778em"></mspace>
            <mtext>22 negated is 1</mtext></mrow>
    </math>

<canvas class="numline animated" id="canvas-field-negate" width="500" height="80"></canvas>

<h4>Division (multiplicative inverse)</h4>
<p>
Division is where things become interesting. Let's start by noting
    that any non-zero number <math><mi>n</mi></math> divided by itself is 1:
    <math display="block">
        <mrow>
            <mfrac>
                <mi>n</mi>
                <mi>n</mi>
            </mfrac>
            <mo>=</mo>
            <mn>1</mn>
        </mrow>
    </math>
Or if we expand some terms:
    <math display="block">
        <mrow>
            <mi>n</mi><mo>&middot;</mo>
            <mfrac><mn>1</mn><mi>n</mi></mfrac>
            <mo>=</mo><mn>1</mn>
        </mrow>
    </math>
Let's use a different notation for
    <math><mfrac><mn>1</mn><mi>n</mi></mfrac></math>
    which is easier to fit on a line:
    <math display="block">
        <mrow>
            <mi>n</mi><mo>&middot;</mo>
            <msup><mi>n</mi><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup>
            <mo>=</mo><mn>1</mn>
        </mrow>
    </math>

<p>
    Based on the above, you can see that dividing by <math><mi>n</mi></math> is the same as multiplying
    by the term <math><msup><mi>n</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup></math>.
<p>
    In the multiplication description above you can see how it's possible for two
    positive integers to equal 1 when multiplied together.
    It turns out that for each positive integer in <span class="fat-fp">Fp</span> there is one
    positive integer that acts as this "multiplicative inverse":
<canvas class="numline animated" id="canvas-field-div" width="500" height="80"></canvas>

<p>
To tie it all together, when working in <span class="fat-fp">Fp</span> any time we need to divide by a number
    <math><mi>n</mi></math> we will instead multiply by its multiplicative inverse
    <math><msup><mi>n</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup></math>,
    the number which satisfies the equation
    <math>
        <mrow>
            <mi>n</mi><mo>&middot;</mo>
            <msup><mi>n</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup>
            <mo>=</mo><mn>1</mn>
        </mrow>
    </math>.

<p>
    The inverse for each number in
    <span class="fat-fp-23">F23</span> is provided <a target="_blank" href="inverse23.html">in this table</a>.

<h4>Square root</h4>
<p>
    Our last operation to define is taking a square root.
    We'll define the square root of <math><mi>n</mi></math>
    as a number in <span class="fat-fp">Fp</span>
    which satisfies this equation:
    <math display="block">
        <mrow>
            <msqrt>
                <mi>n</mi>
            </msqrt>
            <mo>√ó</mo>
            <msqrt>
                <mi>n</mi>
            </msqrt>
            <mo>=</mo>
            <mi>n</mi>
        </mrow>
    </math>
<p>
In real numbers there are two solutions to this problem for non-zero numbers (positive and negative).
Non-zero numbers in <span class="fat-fp">Fp</span> also have two solutions.

    <canvas class="numline animated" id="canvas-field-sqrt" width="500" height="80"></canvas>

<p>
    Only half of the non-zero members of <span class="fat-fp">Fp</span> have square roots.
    The square roots in <span class="fat-fp-23">F23</span> are
    provided <a target="_blank" href="sqrt23.html">in this table</a>.
</div>

<h2>Concept 3: Elliptic curves <em>plus</em> finite fields</h2>
<div>
<p>
Now we can combine the two concepts of elliptic curves and finite field math.
<p>
Let's start with an elliptic curve equation:
    <math display="block" class="pt1">
        <mrow>
            <msup>
                <mi>y</mi>
                <mn>2</mn>
            </msup>
            <mo>=</mo>
            <msup>
                <mi>x</mi>
                <mn>3</mn>
            </msup>
            <mo>+</mo>
            <mn>9</mn>
            <mi>x</mi>
            <mo>+</mo>
            <mn>1</mn>
        </mrow>
    </math>
<p>For our finite field we choose the prime number 61:

    <math display="block" class="pt1">
        <mrow>
            <msub><mi>ùîΩ</mi><mn>61</mn></msub>
            <mo>=</mo>
            <mo form="prefix" stretchy="false">{</mo>
            <mn>0</mn>
            <mo separator="true">,</mo>
            <mn>1</mn>
            <mo separator="true">,</mo>
            <mn>2</mn>
            <mo separator="true">,</mo>
            <mo>‚Ä¶</mo>
            <mo separator="true">,</mo>
            <mn>60</mn>
            <mo form="postfix" stretchy="false">}</mo>
        </mrow>
    </math>
<p>
We'll also pre-compute the tables for <a href="inverse61.html">division</a> and <a href="sqrt61.html">square roots</a>
in <span class="fat-fp-61">F61</span>.

<p>
What would it look like to plot this elliptic curve on a graph?
Starting with <math><mi>x</mi><mo>=</mo><mn>0</mn></math>,
and working through each number from 0 to 60, and using the math operations defined for
    <span class="fat-fp-61">F61</span>:

<table class="results">
    <tbody id="mult-table-body"></tbody>
</table>
<script type=module>
    import * as common from './common.js';
    import * as field61 from './curve/field.js';

    for (let i = 0; i <= 5; i++) {
        const tr = document.createElement('tr');
        let y2 = i**3 + 9*i + 1;
        let y = field61.sqrt(y2 % 61);
        tr.innerHTML = `
        <td><math><mrow>
            <mi>x</mi><mo>=</mo><mn>${i}</mn><mtext>:</mtext>
        </mrow></math></td>
        <td><math><mrow>
            <msup><mi>y</mi><mn>2</mn></msup>
            <mo>=</mo>
            <msup><mn>${i}</mn><mn>3</mn></msup><mo>+</mo><mn>9</mn><mo>‚ãÖ</mo><mn>${i}</mn>
                <mo>+</mo><mn>1</mn><mo>=</mo><mn>${y2}</mn><mi>%</mi><mn>61</mn>
                <mo>=</mo><mn>${y2 % 61}</mn>
            <mtext>;</mtext>
        </mrow></math></td>
        <td><math><mrow>
            <mi>y</mi><mo>=</mo><msqrt><mn>${y2 % 61}</mn></msqrt><mo>=</mo><mtext>
            ${y ? y[0] + ' and ' + y[1] : 'undefined'}
            </mtext>
        </mrow></math></td>
        `;
        common.byId('mult-table-body').appendChild(tr);
    }
    const lastTr = document.createElement('tr');
    lastTr.innerHTML = `<tr><td colspan=3>... and so on ...</td></tr>`;
    common.byId('mult-table-body').appendChild(lastTr);
</script>

<p>
The resulting graph is this:
<figure class="illustration">
    <div class="ill-content">
    <canvas id="canvas-curve61-static" width="500" height="400"></canvas>
    </div>
    <figcaption>An elliptic curve plotted in <span class="fat-fp-61">Fp</span></figcaption>
</figure>

<p>
We can add points on this curve, using the math of <span class="fat-fp-61">F61</span> and
the rules of point addition (draw lines between two points, find the curve intersection, negate the point):

<figure class="illustration">
<div class="ill-content">
    <canvas class="animated" id="canvas-addp" width="500" height="400"></canvas>
</div>
    <figcaption>Curve61 point addition</figcaption>
</figure>

<p>The animation above shows lines wrapping between 61 and 0 (the modulus effect shown visually),
    sometimes many times. Finding the values with math is relatively easy though, just remember
    to use the rules of finite field math:
<p>
    To double a point P
    <math>
        <mrow>
            <mo form="prefix" stretchy="false">(</mo>
            <msub><mi>x</mi><mn>1</mn></msub>
            <mo separator="true">,</mo>
            <msub><mi>y</mi><mn>1</mn></msub>
            <mo form="postfix" stretchy="false">)</mo>
        </mrow>
    </math>
    to get 2P
    <math>
        <mrow>
            <mo form="prefix" stretchy="false">(</mo>
            <msub><mi>x</mi><mn>2</mn></msub>
            <mo separator="true">,</mo>
            <msub><mi>y</mi><mn>2</mn></msub>
            <mo form="postfix" stretchy="false">)</mo>
        </mrow>
    </math>:

<math display="block">
    <mrow>
        <mi>Œª</mi>
        <mo>=</mo>
        <mfrac>
            <mrow>
                <mn>3</mn>
                <msubsup>
                    <mi>x</mi>
                    <mn>1</mn>
                    <mn>2</mn>
                </msubsup>
                <mo>+</mo>
                <mn>9</mn>
            </mrow>
            <mrow>
                <mn>2</mn>
                <msub>
                    <mi>y</mi>
                    <mn>1</mn>
                </msub>
            </mrow>
        </mfrac>
    </mrow>
</math>
<math display="block">
    <mrow>
        <msub>
            <mi>x</mi>
            <mn>2</mn>
        </msub>
        <mo>=</mo>
        <msup>
            <mi>Œª</mi>
            <mn>2</mn>
        </msup>
        <mo>‚àí</mo>
        <msub>
            <mi>x</mi>
            <mn>1</mn>
        </msub>
        <mo>‚àí</mo>
        <msub>
            <mi>x</mi>
            <mn>1</mn>
        </msub>
    </mrow>
</math>
<math display="block">
    <mrow>
        <msub>
            <mi>y</mi>
            <mn>2</mn>
        </msub>
        <mo>=</mo>
        <mi>Œª</mi>
        <mo form="prefix" stretchy="false">(</mo>
        <msub>
            <mi>x</mi>
            <mn>1</mn>
        </msub>
        <mo>‚àí</mo>
        <msub>
            <mi>x</mi>
            <mn>2</mn>
        </msub>
        <mo form="postfix" stretchy="false">)</mo>
        <mo>‚àí</mo>
        <msub>
            <mi>y</mi>
            <mn>1</mn>
        </msub>
    </mrow>
</math>
<p>
    To add two points P
    <math>
        <mrow>
            <mo form="prefix" stretchy="false">(</mo>
            <msub><mi>x</mi><mn>1</mn></msub>
            <mo separator="true">,</mo>
            <msub><mi>y</mi><mn>1</mn></msub>
            <mo form="postfix" stretchy="false">)</mo>
        </mrow>
    </math>
    and Q
    <math>
        <mrow>
            <mo form="prefix" stretchy="false">(</mo>
            <msub><mi>x</mi><mn>2</mn></msub>
            <mo separator="true">,</mo>
            <msub><mi>y</mi><mn>2</mn></msub>
            <mo form="postfix" stretchy="false">)</mo>
        </mrow>
    </math>
    to get a third point R
    <math>
        <mrow>
            <mo form="prefix" stretchy="false">(</mo>
            <msub><mi>x</mi><mn>3</mn></msub>
            <mo separator="true">,</mo>
            <msub><mi>y</mi><mn>3</mn></msub>
            <mo form="postfix" stretchy="false">)</mo>
        </mrow>
    </math>:

<math display="block">
    <mrow>
        <mi>Œª</mi>
        <mo>=</mo>
        <mfrac>
            <mrow>
                <msub><mi>y</mi><mn>2</mn></msub><mo>‚àí</mo><msub><mi>y</mi><mn>1</mn></msub>
            </mrow>
            <mrow>
                <msub><mi>x</mi><mn>2</mn></msub><mo>‚àí</mo><msub><mi>x</mi><mn>1</mn></msub>
            </mrow>
        </mfrac>
    </mrow>
</math>
<math display="block">
    <mrow>
        <msub><mi>x</mi><mn>3</mn></msub><mo>=</mo>
        <msup><mi>Œª</mi><mn>2</mn></msup>
        <mo>‚àí</mo>
        <msub><mi>x</mi><mn>1</mn></msub>
        <mo>‚àí</mo>
        <msub><mi>x</mi><mn>2</mn></msub>
    </mrow>
</math>
<math display="block">
    <mrow>
        <msub><mi>y</mi><mn>3</mn></msub>
        <mo>=</mo>
        <mi>Œª</mi>
        <mo form="prefix" stretchy="false">(</mo>
        <msub><mi>x</mi><mn>1</mn></msub>
        <mo>‚àí</mo>
        <msub><mi>x</mi><mn>3</mn></msub>
        <mo form="postfix" stretchy="false">)</mo>
        <mo>‚àí</mo>
        <msub><mi>y</mi><mn>1</mn></msub>
    </mrow>
</math>
</div>

</div> <!-- container -->

<script>
    let fs = document.getElementsByClassName('fat-fp')
    for (let f of fs) {
        f.innerHTML = '<span>&#x1D53D;<sub>p</sub></span>';
    }
    fs = document.getElementsByClassName('fat-fp-23')
    for (let f of fs) {
        f.innerHTML = '<span>&#x1D53D;<sub>23</sub></span>';
    }
    fs = document.getElementsByClassName('fat-fp-61')
    for (let f of fs) {
        f.innerHTML = '<span>&#x1D53D;<sub>61</sub></span>';
    }
</script>
</body>
</html>
