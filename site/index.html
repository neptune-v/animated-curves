<!DOCTYPE html>
<html lang="en" ontouchmove>
<head>
    <meta charset="UTF-8">
    <title>Visualizing Elliptic Curves</title>
    <script type="module" src="page.js"></script>
    <link href="site.css" rel="stylesheet">
    <!-- xxx todo grab only what we need -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
          rel="stylesheet" crossorigin="anonymous">
</head>
<body>
<div class="container">
<h2>Consider the curve</h2>
<div>
<p>
    Every TLS 1.3 session starts with a key exchange
    made via an elliptic curve. The most popular curve is
    Curve25519, and the exchange involves adding a "base point"
    <span class="math">P</span> to
    itself over and over again:
</p>
<div class="illustration">
<div class="ill-content">
<span class="ill-title">Curve25519 point multiplication</span>
<div>
    <canvas id="canvas-curve25519" width="500" height="250">
    </canvas>
</div>
<span id="np-255-desc">
    <span class="point-255np"><span id="n-255">1</span>P</span>:
    <br>
    <span class="smaller"
    >&nbsp;&nbsp;x=<span class="squish"
    >0x<span id="np-x-255">9</span>
    </span></span>
    <br>
    <span class="smaller"
    >&nbsp;&nbsp;y=<span class="squish"
    >0x<span id="np-y-255">20ae19a1b8a086b4e01edd2c7748d14c923d4d7e6d7c61b229e9c5a27eced3d9</span>
    </span></span>
</span>
</div>
</div>
<p>
    We're looking at the heart of TLS 1.3 key exchange,
    but what's going on? Let's break it down into simple parts.
</p>
</div>

<h2>Concept 1: Adding points</h2>
<p>
    The elliptic curves we're going to start with are in this form:
<div class="text-center">
<span class="math">y<sup>2</sup> = x<sup>3</sup> + Ax + B</span>
</div>
<br>

<div>
<div class="illustration">
<div class="ill-content">
<span class="ill-title">Examples of elliptic curves</span>
<div>
<canvas id="canvas-ec-sample" width="500" height="300">
</canvas>
</div>
<div class="text-center"><span class="math text-center">
    y<sup>2</sup> =
    x<sup>3</sup> + <span id="ec-sample-a">a</span>x
    + <span id="ec-sample-b">b</span></span></div>
</div>
</div>

<p>
    Let's define <strong>point addition</strong>: a way to combine two points on an elliptic
    curve to yield a third point (also on the curve).
<figure>
    <figcaption>Point addition:</figcaption>
    <ul>
    <li>draw a line between the two points
    (or if you're adding a point to itself, make a line tangent to the curve at that
    point),</li>
    <li>find where that line intersects the curve,</li>
    <li>and finally find the point opposite the x-axis from that intersection.</li>
    </ul>
</figure>
<p>As a shorthand for adding a point to itself multiple times, let's also introduce
    <strong>scalar multiplication</strong>:
<ul class="no-bullet">
    <li><span class="math">P+P = 2P</span></li>
    <li><span class="math">P+P+P = 3P</span></li>
    <li><span class="math">P+P+P+P = 4P</span></li>
    <li>... and so on.</li>
</ul>
<div class="illustration">
<div class="ill-content">
<span class="ill-title">Point addition</span>
<canvas id="canvas-real-add" height="400" width="500">
</canvas>
<div class="text-center"><span id="real-add-desc"></span></div>
</div>
</div>

<p>
    Point addition has two useful properties, which we'll make use of later in the document.
<ul>
    <li><strong>commutative</strong>: adding points in any order gives the same result:
        <div class="text-center"><span class="math">P + Q = Q + P</span></div></li>
    <li><strong>associative</strong>: any grouping of addition gives the same result:
        <div class="text-center"><span class="math">P+P+P+P+P = (P+P+P)+(P+P) = 3P+2P = 5P</span></div>
        <div class="text-center"><span class="math">P+P+P+P+P = (P)+(P+P+P+P) = 1P+4P = 5P</span></div>
    </li>
</ul>
<p>
    See the figure below, which demonstrates the commutative and associative properties by adding points in random order.
    Addition of points always results in the point we'd expect.
</p>

<div class="illustration">
<div class="ill-content">
<span class="ill-title">Associative and commutative</span>
<canvas id="canvas-real-assoc" width="500" height="400"></canvas>
<div class="text-center"><span id="real-assoc-desc"></span></div>
</div>
</div>
</div>

<h2>Concept 2: Finite field math</h2>
<div>
</div>

<h2>Concept 3: Elliptic curves <em>plus</em> finite fields</h2>
<div>
</div>

<h2>A toy curve</h2>
<p>
    The curve Curve25519 is <em>huge</em>. Numbers range from <span class="math">0</span>
    to <span class="math">2<sup>255</sup>-19</span>. That's a 77-digit number!
    Let's make a smaller curve that's easier to talk about.
</p>
<p>
    Our smaller curve (let's call it "Curve61") ranges from 0 to 61,
    and the curve equation will be:
    <span class="math center-block">
    y<sup>2</sup> = x<sup>3</sup> + 38x<sup>2</sup> + x
    </span>
</p>
<div class="illustration">
<div class="ill-content">
<span class="ill-title">Curve61 point addition</span>
<div>
    <canvas id="canvas-addp" width="500" height="400">
    </canvas>
</div>
<span>Base point <span class="point-p">P</span> is:
    <span class="x-point-p">(7, 4)</span></span>
<br>
<span id="np-desc">
    Point <span class="point-np"><span id="n">1</span>P</span> is:
    <span id="np" class="x-point-np">(7, 4)</span>
</span>
</div>
</div>

</div> <!-- container -->
</body>
</html>
